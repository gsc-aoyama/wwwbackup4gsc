/*
 jquery.uaTab.js.
 @author Uniteair Co.,Ltd.
*/
(function(d,i,j,f){d.uaTab=function(a,c){d.data(a,"uaTab",this);this.options=d.extend({},this.options,c);this.element=d(a);this.initialize.call(this,c)};d.uaTab.serial=-1;d.uaTab.prototype={options:{defaultIndex:0,selector_tabs:".ua-tab-tabs",selector_contents:".ua-tab-contents",className_active:"ua-tab-active",transition:false,transitionSpeed:200,complete:"",wai_aria:false,useHash:true,tabImageMode:false,tabImageHoverSuffix:"_ovr",tabImageActiveSuffix:"_cur"},$tabs:f,$contents:f,$activeTab:f,$relatedTab:f,
$activeContent:f,$relatedContent:f,serial:-1,instanceName:f,initialize:function(){var a=this.options;this.serial=this._serial();this.instanceName="uaTab"+this.serial;this.$tabs=d(a.selector_tabs,this.element);this.$contents=d(a.selector_contents,this.element);a.tabImageMode&&this.preloadTabImages();a.wai_aria&&this.attach_WAI_ARIA();this.eventify();if(a.useHash&&RegExp(this.instanceName).test(location.hash))this.hashChangeHandler();else this.update(a.defaultIndex)&&this.show();this.$tabs.find("a").css({outline:0})},
preloadTabImages:function(){var a=this.$tabs.find("img"),c=this.options;this.loadImageLength=a.size();a.each(function(b){var e=a.eq(b).attr("src"),g=c.tabImageHoverSuffix?e.replace(/\.(jpg|gif|png)/,c.tabImageHoverSuffix+".$1"):false,h=c.tabImageActiveSuffix?e.replace(/\.(jpg|gif|png)/,c.tabImageActiveSuffix+".$1"):false;a.eq(b).data("uaTab",{originalSrc:e,hoverSrc:g,activeSrc:h,hoverSrcComplete:false,activeSrcComplete:false});g&&d("<img>").attr("src",g).load(function(){a.eq(b).data("uaTab").hoverSrcComplete=
true});h&&d("<img>").attr("src",h).load(function(){a.eq(b).data("uaTab").activeSrcComplete=true})})},eventify:function(){var a=this.options;this.$tabs.delegate("a","click.uaTab",d.proxy(this.tabClickHandler,this));this.options.useHash&&d(i).bind("hashchange.uaTab",d.proxy(this.hashChangeHandler,this));if(a.tabImageMode&&a.tabImageHoverSuffix){this.$tabs.delegate("img","mouseenter.uaTab",d.proxy(this.tabMouseEnterHandler,this));this.$tabs.delegate("img","mouseleave.uaTab",d.proxy(this.tabMouseLeaveHandler,
this))}},tabClickHandler:function(a){var c=this.options;a=this.$tabs.find("li").index(d(a.target).closest("li"));if(c.useHash)this.setHash(a);else this.update(a)&&this.show();return false},tabMouseEnterHandler:function(a){var c=this,b=d(a.target);if(b.closest("li").hasClass(this.options.className_active))return true;b.data("uaTab").hoverSrcComplete||setTimeout(function(){c.tabMouseEnterHandler(a)},100);b.attr("src",b.data("uaTab").hoverSrc);return false},tabMouseLeaveHandler:function(a){a=d(a.target);
if(a.closest("li").hasClass(this.options.className_active))return true;a.attr("src",a.data("uaTab").originalSrc);return false},setHash:function(a){var c=decodeURIComponent(location.hash).substr(1),b=c?d.unparam(c):{},e;if(c)for(e in b){if(b.hasOwnProperty(e))b[this.instanceName]=a}else b[this.instanceName]=a;location.hash=encodeURI(d.param(b))},hashChangeHandler:function(){var a=f,c=decodeURIComponent(location.hash).substr(1),b=f,e;this.$activeTab&&(a=this.$tabs.find("li").index(this.$activeTab));
c&&(b=d.unparam(c));if(b)for(e in b)b.hasOwnProperty(e)&&e===this.instanceName&&parseInt(b[this.instanceName],10)!==parseInt(a,10)&&this.update(b[this.instanceName])&&this.show();return false},update:function(a){var c=this.$tabs.find("li").eq(a),b=c.find("a").attr("href");b=d(b,this.$contents);if(this.$activeTab&&this.$tabs.find("li").index(this.$activeTab)===a)return false;this.$relatedTab=this.$activeTab;this.$relatedContent=this.$activeContent;this.$activeTab=c;this.$activeContent=b;return true},
show:function(){var a=this.options,c=this.options.complete||this.options.transitionEnd;if(a.transition)this.transitionHandler(c);else{this.$contents.children().hide();this.$activeContent.show();c&&d.isFunction(c)&&this.applyCallback(c)}this.$relatedTab&&this.$relatedTab.removeClass(a.className_active);this.$activeTab.addClass(a.className_active);a.tabImageMode&&a.tabImageActiveSuffix&&this.setActiveTabImage()},transitionHandler:function(a){this.options.transition==="fade"&&this.transitionFade(a)},
transitionFade:function(a){var c=this;this.$contents.children().hide();this.$activeContent.fadeIn(this.options.transitionSpeed,function(){a&&d.isFunction(a)&&c.applyCallback(a)})},setActiveTabImage:function(){var a;if(this.$relatedTab){a=this.$relatedTab.find("img");a.attr("src",a.data("uaTab").originalSrc)}a=this.$activeTab.find("img");a.attr("src",a.data("uaTab").activeSrc)},applyCallback:function(a){a({content:this.$activeContent,relatedContent:this.$relatedContent})},attach_WAI_ARIA:function(){this.element.attr("role",
"application");this.$tabs.attr("role","tablist");d("li",this.$tabs).attr("role","tab").each(function(a,c){var b=d(c);b.attr("aria-controls",b.find("a").attr("href").substr(1))});this.$contents.children().attr("role","tabpanel").each(function(a,c){var b=d(c);d("li",this.$tabs).each(function(e,g){var h=d(g);if(b.attr("id")===h.attr("aria-controls")){b.attr("aria-labeledby",h.attr("aria-controls"));return false}})})},_serial:function(){return++d.uaTab.serial}};d.fn.uaTab=function(a){return this.each(function(){new d.uaTab(this,
a)})};d.unparam=function(a){var c={};a=a.split("&");var b,e,g;e=0;for(g=a.length;e<g;e++){b=a[e].split("=",2);c[decodeURIComponent(b[0])]=b.length==2?decodeURIComponent(b[1].replace(/\+/g," ")):true}return c}})(jQuery,window,document);
